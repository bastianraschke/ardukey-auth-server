## ArduKey authserver
## written by Bastian Raschke
##


## Installation
##

First you have to install the server via your package manager. For example:

~# apt-get install ardukey-auth-server

Important note: First you need to add the "PM Codeworks" repository. See
http://www.pm-codeworks.de/repository.html for the instructions.


## Optional: Manual package build
##

If you don't want to use pre-build packages, you can easyly build your own
packages using the tool "debuild":

~$ debuild

After that, the generated packages can be found in the upper directory. You can
install the packages with "dpkg":

~# dpkg -i ../*.deb

And fix the dependency problems, if occurred:

~# apt-get -f install

## Configuration
## Note: All changes will be done in file "/etc/ardukey-auth-server.conf".
##

You should change the address, the server is listening on. This address
must be available for the clients (PAM module for example). Otherwise the
clients will not be able to do two factor authentication!

server_address = 11.22.33.44

Testart the auth server:

~# /etc/init.d/ardukey-auth-server restart


## Maintaining
##

First add an ArduKey with the following command:

~# ardukey-auth-conf --add-ardukey cccccccccccb b0d4a2d69bc4 7a1858592fcb76bd5eb2685421aed45e

An ArduKey with the public id "cccccccccccb", the secret id "b0d4a2d69bc4" and
the AES key "7a1858592fcb76bd5eb2685421aed45e" will be added.

Now, generate an API key to be able to sign your requests to your auth server:

~# ardukey-auth-conf --generate-apikey

The command outputs the "API id" and the "Shared secret". Every system/service
which wants to communicate with the auth server needs its own API key!

For example an administrator who wants to set up an ArduKey PAM module on his
server needs one API key to be able to use his auth server.

Check out the man page of "ardukey-auth-conf" for all available commands:

~$ man ardukey-auth-conf


## Request structure
##

Requests will be sent via HTTP GET to:

http://127.0.0.1:8080/ardukeyotp/1.0/verify

with the follwing parameters:

Parameter | Description
----------------------------------------------------
otp       | The one-time-pad type by an ArduKey.
nonce     | A random string, to make request unique.
apiId     | The API id, to identify the API key.
hmac      | The signature of this request.

The Hmac is a SHA-256 hash value that is calculated by key sorted (alphabetical)
request parameter values: hmac = SHA256(apiId + otp + nonce)


## Debugging start
##

You can also start the server in debugging mode. First shut down the
"ardukey-auth-server" service which runs on the server:

~# /etc/init.d/ardukey-auth-server stop

Than start service in debugging mode:

~# ardukey-auth-server --debug

Now you will see all debugging output from the ardukey-auth-server.
